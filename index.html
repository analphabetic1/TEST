<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¥­é¬¥åœ°ä¸»è¨ˆåˆ†ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --primary: #4a90e2; --success: #4caf50; --danger: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f7fa; margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: auto; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 15px; }
        
        /* èº«ä»½é¸æ“‡ */
        .user-selector { display: flex; gap: 10px; margin-bottom: 15px; }
        .user-btn { flex: 1; padding: 8px; border: 2px solid #ddd; border-radius: 8px; cursor: pointer; text-align: center; }
        .user-btn.active { border-color: var(--primary); background: #eef5ff; }

        /* è¨ˆåˆ†æ¿ */
        .score-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center; margin: 15px 0; }
        .score-box { font-size: 1.5rem; font-weight: bold; color: var(--primary); }

        /* æ§åˆ¶é … */
        .control-group { margin: 15px 0; display: flex; align-items: center; justify-content: space-between; }
        .switch { position: relative; display: inline-block; width: 50px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider-round { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider-round:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider-round { background-color: var(--success); }
        input:checked + .slider-round:before { transform: translateX(26px); }

        /* æ­·å²ç´€éŒ„ */
        .history-list { font-size: 0.9rem; max-height: 200px; overflow-y: auto; border-top: 1px solid #eee; padding-top: 10px; }
        .history-item { padding: 5px 0; border-bottom: 1px solid #fafafa; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h3>ğŸ‘¤ æˆ‘æ˜¯èª°ï¼Ÿ</h3>
        <div class="user-selector" id="meSelector">
            <div class="user-btn" onclick="setMe('A')">A</div>
            <div class="user-btn" onclick="setMe('E')">E</div>
            <div class="user-btn" onclick="setMe('D')">D</div>
        </div>
        <p id="currentUserDisplay">è«‹å…ˆé¸æ“‡æ‚¨çš„èº«ä»½</p>
    </div>

    <div class="card">
        <h3>ğŸ“Š ç›®å‰ç¸½åˆ†</h3>
        <div class="score-grid">
            <div>A<div id="scoreA" class="score-box">0</div></div>
            <div>E<div id="scoreE" class="score-box">0</div></div>
            <div>D<div id="scoreD" class="score-box">0</div></div>
        </div>
    </div>

    <div class="card">
        <h3>ğŸ†• æ–°å¢å±€æ•¸</h3>
        <div class="control-group">
            åœ°ä¸»ï¼š<select id="landlord"><option>A</option><option>E</option><option>D</option></select>
            çµæœï¼š<select id="winLoss"><option value="1">åœ°ä¸»è´</option><option value="-1">åœ°ä¸»è¼¸</option></select>
        </div>
        
        <div class="control-group">
            <span>ğŸš€ ç«ç®­ (x2)</span>
            <label class="switch"><input type="checkbox" id="rocket"><span class="slider-round"></span></label>
        </div>

        <div class="control-group">
            <span>ğŸŒ¸ æ˜¥å¤© (x2)</span>
            <label class="switch"><input type="checkbox" id="spring"><span class="slider-round"></span></label>
        </div>

        <div class="control-group">
            <span>ğŸ’£ ç‚¸å½ˆæ•¸é‡ï¼š<span id="bombVal">0</span></span>
            <input type="range" id="bombs" min="0" max="5" value="0" oninput="bombVal.innerText=this.value">
        </div>

        <button onclick="submitScore()" style="width:100%; padding:15px; background:var(--primary); color:white; border:none; border-radius:8px; font-weight:bold;">ç¢ºèªä¸Šå‚³ç´€éŒ„</button>
    </div>

    <div class="card">
        <h3>ğŸ“œ æ­·å²ç´€éŒ„</h3>
        <div id="historyList" class="history-list">è¼‰å…¥ä¸­...</div>
    </div>
</div>

<script>
    const SUBAPASE_URL = "https://mmnauzvhnguffpmevrup.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1tbmF1enZobmd1ZmZwbWV2cnVwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc2MjI1NjcsImV4cCI6MjA4MzE5ODU2N30.8GUyft8yVecvju7ecjcBwt1j2aqDL-WjThLA17iOcoE";
    const supabase = supabase.createClient(SUBAPASE_URL, SUPABASE_KEY);

    let myName = "";

    function setMe(name) {
        myName = name;
        document.querySelectorAll('.user-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        document.getElementById('currentUserDisplay').innerText = "ç•¶å‰æ“ä½œè€…ï¼š" + name;
    }

    async function submitScore() {
        if(!myName) return alert("è«‹å…ˆé¸æ“‡ä½ æ˜¯èª°ï¼");
        
        const landlord = document.getElementById('landlord').value;
        const winLoss = parseInt(document.getElementById('winLoss').value);
        const hasRocket = document.getElementById('rocket').checked;
        const hasSpring = document.getElementById('spring').checked;
        const bombCount = parseInt(document.getElementById('bombs').value);
        
        // è¨ˆç®—å€æ•¸ï¼šåŸºç¤ 1 * ç«ç®­(2) * æ˜¥å¤©(2) * 2^ç‚¸å½ˆæ•¸
        let multiplier = 1;
        if(hasRocket) multiplier *= 2;
        if(hasSpring) multiplier *= 2;
        multiplier *= Math.pow(2, bombCount);

        const baseScore = 10; // å‡è¨­åº•åˆ† 10
        const points = baseScore * multiplier * winLoss;

        // 1. å¯«å…¥æ­·å²ç´€éŒ„
        await supabase.from('history').insert([{
            added_by: myName, landlord, is_rocket: hasRocket, is_spring: hasSpring, bombs: bombCount, final_points: points
        }]);

        // 2. æ›´æ–°ç¸½åˆ† (é€™éƒ¨åˆ†é‚è¼¯é€šå¸¸åœ¨å¾Œç«¯æˆ–ç”±å‰ç«¯åŠ ç¸½æ­·å²ç´€éŒ„ï¼Œé€™è£¡ç°¡åŒ–è™•ç†)
        alert("ç´€éŒ„æˆåŠŸï¼");
        location.reload(); // ç°¡å–®è®“å®ƒé‡æ–°æŠ“å–æ•¸æ“š
    }

    // é€™è£¡é‚„éœ€è¦åŠ ä¸Šå¾ Supabase æŠ“å–è³‡æ–™èˆ‡ Realtime ç›£è½çš„ä»£ç¢¼...
</script>
</body>
</html>
